#!/bin/bash
set -e

if [ ! -f $PWD/*.spec ]; then
    echo "No specfile in current directory found!"
    echo "This script is meant to be executed from the dir"
    echo "where all files for a package that needs to be tested"
    echo "are located"
    exit 1
fi

RPMBUILDDIR="$HOME/rpmbuild"
rm -vrf "$RPMBUILDDIR"
for d in /usr/src/packages/*; do
    d=${d##*/}
    mkdir -vp "$RPMBUILDDIR/$d"
done
cp -v ./* "$RPMBUILDDIR/SOURCES"
SPECFILE=$(ls ./*.spec)
ln -vs "$RPMBUILDDIR/SOURCES/$SPECFILE" "$RPMBUILDDIR/SPECS/"
